<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#0b0f1a" />
    <title>Shmup Zero</title>
    <link rel="manifest" href="./manifest.json" />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <noscript>本ゲームを遊ぶには JavaScript を有効にしてください。</noscript>

    <div id="app">
      <!-- 上部ステータスバー -->
      <div id="topBar" class="bar top-bar">
        <div id="hud" class="hud">
          <div class="hud-left">
            <div class="score">SCORE: <span id="scoreValue">0</span></div>
            <div class="highscore">BEST: <span id="highScoreValue">0</span></div>
          </div>
          <div class="hud-right">
            <div class="health">
              HP
              <div class="healthbar">
                <div id="healthFill" class="healthbar-fill" style="width:100%"></div>
              </div>
            </div>
            <button id="pauseBtn" class="btn" aria-label="一時停止">⏸</button>
          </div>
        </div>
      </div>

      <!-- ステージ領域（キャンバス） -->
      <div id="stage" class="stage">
        <canvas id="gameCanvas" aria-label="横スクロールシューティング"></canvas>
        <!-- ボスHPバー（キャンバス上部中央に重ねる） -->
        <div id="bossHud" class="boss-hud hidden">
          <div class="bossbar">
            <div id="bossLabel" class="bossbar-label">BOSS</div>
            <div class="bossbar-track">
              <div id="bossBarFill" class="bossbar-fill" style="width:100%"></div>
            </div>
          </div>
        </div>
      </div>

        <!-- モバイル発射ボタン（右下固定） -->
        <button id="fireBtn" class="btn fire-btn" aria-label="発射">🚀 発射</button>

          <!-- ポーズ設定オーバーレイ -->
          <div id="pauseSettings" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="pauseSettingsTitle">
            <div class="panel settings-panel">
              <h2 id="pauseSettingsTitle" class="title">ポーズ設定</h2>
              <form id="settingsForm" class="settings-form">
                <fieldset class="settings-group">
                  <legend>操作タイプ</legend>
                  <div class="settings-options settings-modes">
                    <label class="settings-option" for="controlRelative">
                      <input type="radio" name="controlMode" id="controlRelative" value="relative" />
                      <span>バーチャルスティック（現行の操作）</span>
                    </label>
                    <label class="settings-option" for="controlFollow">
                      <input type="radio" name="controlMode" id="controlFollow" value="follow" />
                      <span>指に合わせて機体が追従（以前の操作）</span>
                    </label>
                  </div>
                </fieldset>

                <fieldset class="settings-group">
                  <legend>アイテム獲得状態</legend>
                  <div class="settings-options settings-items">
                    <label class="settings-option" for="itemAttack">
                      <input type="checkbox" id="itemAttack" />
                      <span>攻撃強化（パワーアップ）</span>
                    </label>
                    <label class="settings-option" for="itemCompanion">
                      <input type="checkbox" id="itemCompanion" />
                      <span>子機サポート</span>
                    </label>
                    <label class="settings-option" for="itemBarrier">
                      <input type="checkbox" id="itemBarrier" />
                      <span>バリア（シールド）</span>
                    </label>
                    <label class="settings-option" for="itemSpeed">
                      <input type="checkbox" id="itemSpeed" />
                      <span>スピードアップ</span>
                    </label>
                  </div>
                </fieldset>
              </form>
              <div class="controls settings-controls">
                <button id="settingsApplyBtn" type="button" class="btn primary">設定を反映して再開</button>
                <button id="settingsResumeBtn" type="button" class="btn">変更せずに再開</button>
              </div>
            </div>
          </div>

        <div id="overlay" class="overlay hidden">
          <div class="panel">
            <h1 class="title">Shmup Zero</h1>
            <p class="subtitle">横向きでプレイ推奨。ドラッグで移動 / 右下の発射ボタン長押しで射撃（PC: 矢印/WASD + スペース）</p>
            <div class="controls">
              <button id="startBtn" class="btn primary">ゲーム開始</button>
              <button id="restartBtn" class="btn hidden">もう一度</button>
              <button id="resumeStageBtn" class="btn hidden">同じステージから再開</button>
            </div>
            <div id="finalStats" class="final-stats hidden"></div>
          </div>
        </div>

      <!-- ステージクリア時モーダル -->
      <div id="stageModal" class="overlay hidden">
        <div class="panel">
          <h2 id="stageModalTitle" class="title">ステージ1クリア！</h2>
          <p class="subtitle">次のステージへ進みます。</p>
          <div class="controls">
            <button id="stageModalBtn" class="btn primary">続ける</button>
          </div>
        </div>
      </div>

      <!-- 縦向き時の回転促しオーバーレイ -->
      <div id="rotateOverlay" class="rotate-overlay">
        <div class="panel">
          <h2 class="title">横向きでプレイしてください</h2>
          <p class="subtitle">iPhone を横向きにするとゲームを開始できます。</p>
        </div>
      </div>
    </div>

    <script type="module" src="./game.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./service-worker.js').catch(() => {});
        });
      }
    </script>
  </body>
</html>
